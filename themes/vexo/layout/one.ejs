<link href="https://fonts.googleapis.com/css2?family=Long+Cang&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200&display=swap" rel="stylesheet">

<div id="article-banner">
  <div id="hitokoto" class="one">
    <div class="one_main"><a href="#" id="hitokoto_text" class="one_text" target="_blank">:D 加载中...</a></div>
    <div class="one_source" id="one_source">
      ——&nbsp;<span id="hitokoto_author"></span>&nbsp;<span id="hitokoto_from"></span><span class="one_buttons"><img
          id="refresh_button" onclick="getYiju()" ontouchend="buttonTouchEnd()" src="/css/images/refresh.png" /><img
          id="copy_button" onclick="copyYiju()" ontouchend="buttonTouchEnd()" src="/css/images/copy.png" /></span>
    </div>
  </div>
  <div class="options_container">
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="a" name="hijikoto_type" checked /><label><span></span>动画</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="b" name="hijikoto_type" checked /><label><span></span>漫画</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="c" name="hijikoto_type" checked /><label><span></span>游戏</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="h" name="hijikoto_type" checked /><label><span></span>影视</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="d" name="hijikoto_type" checked /><label><span></span>文学</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="i" name="hijikoto_type" checked /><label><span></span>诗词</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="k" name="hijikoto_type" checked /><label><span></span>哲学</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="e" name="hijikoto_type" checked /><label><span></span>原创</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="l" name="hijikoto_type" checked /><label><span></span>抖机灵</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="j" name="hijikoto_type" checked /><label><span></span>网易云</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="f" name="hijikoto_type" checked /><label><span></span>来自网络</label></span>
    <span style="white-space:nowrap"><input type="checkbox" class="checkbox" value="g" name="hijikoto_type" checked /><label><span></span>其他</label></span>
    <div class="options_control">
      <input type="button" id="checkall" value="全选" />
      <input type="button" id="othercheck" value="反选" />
    </div>
  </div>
</div>

<%- partial('_partial/banner') %>

<main class="app-body">
  <article class="post-article">
    <%- partial('_plugin/waline') %>
    <%- page.content %>
  </article>
</main>

<script>
  function getYiju() {
    let osource = "https://v1.hitokoto.cn?";
    let source = ""
    let htypes = document.getElementsByName("hijikoto_type");
    for (var i = 0; i < htypes.length; i++) {
      if (htypes[i].checked === true) {
        source = source + "c=" + htypes[i].value + "&";
      }
    }

    var CheckAll=document.getElementById('checkall');
    var UnCheck=document.getElementById('uncheck');
    var OtherCheck=document.getElementById('othercheck');
    CheckAll.onclick=function(){
      for(i=0;i<htypes.length;i++){
        htypes[i].checked=true;
      };
    };
    OtherCheck.onclick=function(){
      for(i=0;i<htypes.length;i++){
        if(htypes[i].checked==true){
          htypes[i].checked=false;
        }
        else{
          htypes[i].checked=true
        }         
      };
    }

    fetch(osource + source)
      .then((response) => response.json())
      .then((data) => {
        const hitokoto = document.getElementById("hitokoto_text");
        hitokoto.href = "https://hitokoto.cn/?uuid=" + data.uuid;
        hitokoto.innerText = data.hitokoto;
        const from = document.getElementById("hitokoto_from");
        from.innerText = data.from;
        if (data.from_who != data.from) {
          const author = document.getElementById("hitokoto_author");
          author.innerText = data.from_who;
        } else {
          const author = document.getElementById("hitokoto_author");
          author.innerText = [];
        }
      })
      .catch(console.error);
  }
  getYiju();
</script>

<script>
  function copyYiju() {
    // Create a new textarea element as cache for copying
    let text = document.getElementById("hitokoto").innerText
    const cache_area = document.createElement('textarea');
    document.body.appendChild(cache_area);
    cache_area.innerHTML = text;
    cache_area.select();
    document.execCommand('copy');
    document.body.removeChild(cache_area);

    let input_box = document.getElementById("wl-edit");
    // console.log(input_box);
    if (input_box.value == "") {
      input_box.value = text;
      // dispatch input event to make upload button ready
      let evt = document.createEvent('HTMLEvents')
      evt.initEvent('input', true, true)
      input_box.dispatchEvent(evt)
    } else {
      input_box.select();
    }
  }

  function buttonTouchEnd() {
    $(this).attr(transform, scale(1.1))
  };
</script>